import"./sweetalert2.esm.all-BoFtKDfH.js";const a={steps:[{id:1,title:"Create Walkin",desc:'Walkins are the processors/liason of vehicles. Click "New Walkin" to start.',target:'[data-tutorial-target="walkin-create"]',route:"/walkin",fields:["#email","#accountID","#name","#color","#description","#status"],submit:"#submitBtn"},{id:2,title:"Create Category",desc:'Categories define vehicle types. Click "New Category" to continue.',target:'[data-tutorial-target="category-create"]',route:"/category",fields:["#name","#description","#status"],submit:"#submitBtn"},{id:3,title:"Create Policy",desc:'Policies define price lists. Click "New Policy" to proceed.',target:'[data-tutorial-target="policies-create"]',route:"/policies",fields:["#category_id","#code","#name","#cost"],submit:"#submitBtn"},{id:4,title:"Create Series",desc:'Series are COC numbers from brokers. Click "New Series" to continue.',target:'[data-tutorial-target="series-create"]',route:"/series",fields:["#name","#range_start","#range_stop","#type"],submit:"#submitBtn"},{id:5,title:"Issue Insurance",desc:'Finally, issue an insurance policy. Click "New Insurance" to finish.',target:'[data-tutorial-target="insurance-create"]',route:"/insurances",fields:["#modal-coc_no","#modal-client_id","#modal-policy_id","#modal-registration_no"],submit:"#insuranceSubmitBtn"}],storageKey:"vimsy_tutorial_step",completedKey:"vimsy_tutorial_done"};let n=0,m=!1,r={},u=[];function k(){if(localStorage.getItem(a.completedKey))return;n=parseInt(localStorage.getItem(a.storageKey))||0;const e=sessionStorage.getItem("vimsy_tutorial_active");location.pathname==="/dashboard"&&n===0&&!e&&setTimeout(N,500),(n>0||e)&&z()&&(setTimeout(()=>E(n),800),sessionStorage.removeItem("vimsy_tutorial_active")),window.addEventListener("tutorial:actionCompleted",W)}function z(){const t=a.steps[n];return t&&location.pathname.includes(t.route)}function N(){if(document.getElementById("tutorialWelcome"))return;const t=document.createElement("div");t.id="tutorialWelcome",t.className="tutorial-welcome",t.innerHTML=`
        <div style="text-align:center;padding:30px;">
            <div style="font-size:60px;margin-bottom:15px;">ðŸš—</div>
            <h2 style="margin:0 0 15px;color:#1e293b;">Welcome to VIMSYS!</h2>
            <p style="color:#64748b;margin-bottom:25px;">New here? Take our interactive tutorial to learn the system.</p>
            <button onclick="VIMSYSTutorial.start(0);this.closest('.tutorial-welcome').remove()" 
                style="background:#2563eb;color:white;border:none;padding:12px 30px;border-radius:8px;font-size:16px;cursor:pointer;margin-right:10px;">
                <i class="bi bi-play-fill"></i> Start Tutorial
            </button>
            <button onclick="this.closest('.tutorial-welcome').remove();localStorage.setItem('${a.storageKey}',0)" 
                style="background:#f1f5f9;color:#64748b;border:1px solid #cbd5e1;padding:12px 25px;border-radius:8px;font-size:16px;cursor:pointer;">
                Skip for Now
            </button>
        </div>
    `,document.body.appendChild(t)}function M(){if(document.querySelectorAll(".tutorial-overlay, .tutorial-spotlight, .tutorial-tooltip, .tutorial-arrow, .tutorial-animated-arrow").forEach(t=>t.remove()),r.overlay=document.createElement("div"),r.overlay.className="tutorial-overlay",r.overlay.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:9998;display:none;pointer-events:none;",document.body.appendChild(r.overlay),r.spotlight=document.createElement("div"),r.spotlight.className="tutorial-spotlight",r.spotlight.style.cssText="position:absolute;border-radius:8px;box-shadow:0 0 0 9999px rgba(0,0,0,0.7);z-index:9999;display:none;pointer-events:none;transition:all 0.3s;",document.body.appendChild(r.spotlight),r.tooltip=document.createElement("div"),r.tooltip.className="tutorial-tooltip",r.tooltip.style.cssText="position:absolute;background:white;border:2px solid #2563eb;border-radius:12px;padding:20px;max-width:320px;z-index:10000;display:none;box-shadow:0 10px 40px rgba(0,0,0,0.3);",document.body.appendChild(r.tooltip),r.arrow=document.createElement("div"),r.arrow.className="tutorial-css-arrow down",r.arrow.style.cssText="position:absolute;width:40px;height:40px;z-index:10002;pointer-events:none;animation:tut-arrow-bounce 1s infinite;display:none;",document.body.appendChild(r.arrow),!document.getElementById("tutArrowStyles")){const t=document.createElement("style");t.id="tutArrowStyles",t.textContent=`
            @keyframes tut-arrow-bounce {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-15px); }
            }
            .tutorial-css-arrow::before {
                content: '';
                position: absolute;
                width: 0;
                height: 0;
                border-left: 20px solid transparent;
                border-right: 20px solid transparent;
                border-top: 30px solid #2563eb;
                filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
                left: 0;
                top: 0;
            }
            .tutorial-css-arrow.up::before {
                border-left: 20px solid transparent;
                border-right: 20px solid transparent;
                border-bottom: 30px solid #2563eb;
                border-top: none;
            }
            .tutorial-css-arrow.right::before {
                border-top: 20px solid transparent;
                border-bottom: 20px solid transparent;
                border-left: 30px solid #2563eb;
                border-right: none;
                left: 0;
                top: 0;
            }
            .tutorial-css-arrow.left::before {
                border-top: 20px solid transparent;
                border-bottom: 20px solid transparent;
                border-right: 30px solid #2563eb;
                border-left: none;
                left: 0;
                top: 0;
            }
        `,document.head.appendChild(t)}}function E(t=0){n=t,m=!0,sessionStorage.setItem("vimsy_tutorial_active","true"),M(),y(),f(n)}function f(t){const e=a.steps[t];if(!e){C();return}if(!location.pathname.includes(e.route)){y(),location.href=e.route;return}const o=document.querySelector(e.target);if(!o){console.warn("Tutorial target not found:",e.target),setTimeout(()=>f(t),500);return}Y(o),_(o,e),o.addEventListener("click",function i(){o.removeEventListener("click",i),o.classList.remove("tutorial-highlight"),o.style.zIndex="",o.style.position="",o.style.boxShadow="",o.style.border="",r.spotlight.style.display="none",r.overlay.style.display="none",r.arrow.style.display="none",r.tooltip.style.display="none",setTimeout(()=>F(e),300)},{once:!0})}function Y(t){const e=t.getBoundingClientRect(),o=8;r.spotlight.style.width=e.width+o*2+"px",r.spotlight.style.height=e.height+o*2+"px",r.spotlight.style.left=e.left-o+window.scrollX+"px",r.spotlight.style.top=e.top-o+window.scrollY+"px",r.spotlight.style.display="block",r.overlay.style.display="block",t.classList.add("tutorial-highlight"),t.style.position="relative",t.style.zIndex="10002"}function _(t,e){const o=Math.round(e.id/a.steps.length*100);r.tooltip.innerHTML=`
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <span style="background:#2563eb;color:white;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600;">Step ${e.id} of ${a.steps.length}</span>
            <button onclick="VIMSYSTutorial.skip()" style="background:none;border:none;color:#94a3b8;cursor:pointer;font-size:14px;">âœ•</button>
        </div>
        <h4 style="margin:0 0 8px;color:#1e293b;font-size:18px;">${e.title}</h4>
        <p style="margin:0 0 15px;color:#475569;font-size:14px;line-height:1.5;">${e.desc}</p>
        <div style="background:#dbeafe;border-left:3px solid #2563eb;padding:10px 12px;border-radius:6px;margin-bottom:15px;font-size:13px;color:#1e40af;">
            <i class="bi bi-hand-index-thumb-fill" style="margin-right:6px;"></i>Click the highlighted button
        </div>
        <div style="background:#e2e8f0;height:6px;border-radius:3px;overflow:hidden;margin-bottom:5px;">
            <div style="background:#2563eb;height:100%;width:${o}%;transition:width 0.3s;"></div>
        </div>
        <div style="text-align:center;font-size:12px;color:#64748b;">${o}% Complete</div>
        ${e.id>1?'<button onclick="VIMSYSTutorial.prev()" style="margin-top:15px;background:#f1f5f9;border:1px solid #cbd5e1;padding:8px 16px;border-radius:6px;cursor:pointer;"><i class="bi bi-arrow-left"></i> Back</button>':""}
    `,I(t),r.tooltip.style.display="block",r.arrow.style.display="block",v(t,"down")}function I(t){const e=t.getBoundingClientRect();let o=e.bottom+20+window.scrollY,i=e.left+e.width/2-160+window.scrollX;i<10&&(i=10),i+320>window.innerWidth&&(i=window.innerWidth-330),o+250>window.innerHeight+window.scrollY&&(o=e.top-200+window.scrollY),r.tooltip.style.top=o+"px",r.tooltip.style.left=i+"px"}function v(t,e){const o=t.getBoundingClientRect(),i=40;switch(r.arrow.className="tutorial-css-arrow "+e,e){case"down":r.arrow.style.top=o.top-i-10+window.scrollY+"px",r.arrow.style.left=o.left+o.width/2-i/2+window.scrollX+"px";break;case"up":r.arrow.style.top=o.bottom+10+window.scrollY+"px",r.arrow.style.left=o.left+o.width/2-i/2+window.scrollX+"px";break;case"right":r.arrow.style.top=o.top+o.height/2-i/2+window.scrollY+"px",r.arrow.style.left=o.left-i-10+window.scrollX+"px";break;case"left":r.arrow.style.top=o.top+o.height/2-i/2+window.scrollY+"px",r.arrow.style.left=o.right+10+window.scrollX+"px";break}}function F(t){const e=Math.round(t.id/a.steps.length*100);r.tooltip.innerHTML=`
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
            <span style="background:#2563eb;color:white;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600;">Step ${t.id}</span>
            <span style="font-size:12px;color:#64748b;">Fill Form</span>
        </div>
        <h4 style="margin:0 0 8px;color:#1e293b;font-size:18px;">${t.title}</h4>
        <p style="margin:0 0 15px;color:#475569;font-size:14px;">Hover over or click a field to start. Fill all fields to continue.</p>
        <div style="background:#dbeafe;border-left:3px solid #2563eb;padding:10px 12px;border-radius:6px;margin-bottom:15px;font-size:13px;color:#1e40af;">
            <i class="bi bi-cursor-fill" style="margin-right:6px;"></i><span id="tutFieldInstr">Hover over any field</span>
        </div>
        <div style="text-align:center;font-size:12px;color:#64748b;margin-bottom:10px;">
            Field <span id="tutFieldNum">0</span> of ${t.fields.length}
        </div>
        <div style="background:#e2e8f0;height:6px;border-radius:3px;overflow:hidden;">
            <div style="background:#2563eb;height:100%;width:${e}%;"></div>
        </div>
        <button onclick="VIMSYSTutorial.skip()" style="margin-top:15px;background:#f1f5f9;border:1px solid #cbd5e1;padding:8px 16px;border-radius:6px;cursor:pointer;width:100%;">Skip Tutorial</button>
    `,I(document.querySelector(t.target)||document.body),r.tooltip.style.display="block",A(t)}function A(t){u.forEach(({el:e,handler:o,type:i})=>{e.removeEventListener(i,o)}),u=[],t.fields.forEach((e,o)=>{const i=document.querySelector(e);if(!i)return;let s=i.closest(".floating-label")||i.closest(".form-group")||i.closest(".modal-body")||i.parentElement;const l=p=>{var g;p.stopPropagation(),(g=i.value)!=null&&g.trim()||h(t,o,s,i)},c=()=>{var p;(p=i.value)!=null&&p.trim()||h(t,o,s,i)};s.addEventListener("mouseenter",l),i.addEventListener("mouseenter",l),i.addEventListener("focus",c),u.push({el:s,handler:l,type:"mouseenter"},{el:i,handler:l,type:"mouseenter"},{el:i,handler:c,type:"focus"})}),document.addEventListener("keydown",S),u.push({el:document,handler:S,type:"keydown"})}function S(t){t.key==="Tab"&&m&&setTimeout(()=>{var o;const e=document.activeElement;if(e&&e.matches("input, select, textarea")){const i=a.steps[n];if(!i)return;const s=i.fields.findIndex(l=>document.querySelector(l)===e);if(s!==-1&&!((o=e.value)!=null&&o.trim())){const l=e.closest(".floating-label")||e.closest(".form-group")||e.closest(".modal-body")||e.parentElement;h(i,s,l,e)}}},50)}function h(t,e,o,i){var g,w;document.querySelectorAll(".tutorial-field-active").forEach(d=>{d.classList.remove("tutorial-field-active"),d.style.cssText=""}),o.classList.add("tutorial-field-active"),o.style.cssText="position:relative;z-index:10010 !important;background:#fff !important;border-radius:8px;box-shadow:0 0 0 3px #2563eb,0 0 20px rgba(37,99,235,0.5);padding:5px;transition:all 0.3s;pointer-events:auto;",i.style.cssText="position:relative;z-index:10011 !important;";const s=((w=(g=i.closest(".floating-label"))==null?void 0:g.querySelector("label"))==null?void 0:w.textContent)||i.getAttribute("placeholder")||i.getAttribute("name")||"this field";document.getElementById("tutFieldInstr").innerHTML=`<i class="bi bi-pencil-fill" style="margin-right:6px;"></i>Enter <strong>${s.replace("*","").trim()}</strong>`,document.getElementById("tutFieldNum").textContent=e+1,r.arrow.style.display="block",r.arrow.style.zIndex="10012",v(o,"right"),i.scrollIntoView({behavior:"smooth",block:"center"});let l=o.querySelector(".tut-next-btn");l||(l=document.createElement("button"),l.className="tut-next-btn",l.innerHTML='Next <i class="bi bi-arrow-right"></i>',l.style.cssText="position:absolute;right:-100px;top:50%;transform:translateY(-50%);background:#2563eb;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;display:none;z-index:10013;white-space:nowrap;",o.appendChild(l),l.onclick=d=>{var b;if(d.stopPropagation(),d.preventDefault(),!((b=i.value)!=null&&b.trim())){o.classList.add("tutorial-shake"),setTimeout(()=>o.classList.remove("tutorial-shake"),500);return}o.classList.remove("tutorial-field-active"),o.style.cssText="",i.style.cssText="",l.remove(),T(t)});const c=()=>{var d;l.style.display=(d=i.value)!=null&&d.trim()?"inline-block":"none"};i.removeEventListener("input",c),i.addEventListener("input",c),c();const p=d=>{var b;d.key==="Enter"&&((b=i.value)!=null&&b.trim())&&(d.preventDefault(),o.classList.remove("tutorial-field-active"),o.style.cssText="",i.style.cssText="",l.remove(),T(t))};i.removeEventListener("keydown",p),i.addEventListener("keydown",p)}function T(t){var o;let e=-1;for(let i=0;i<t.fields.length;i++){const s=document.querySelector(t.fields[i]);if(s&&!((o=s.value)!=null&&o.trim())){e=i;break}}if(e===-1)H(t);else{const i=document.querySelector(t.fields[e]),s=i.closest(".floating-label")||i.parentElement;h(t,e,s,i),i.scrollIntoView({behavior:"smooth",block:"center"})}}function H(t){const e=document.querySelector(t.submit);e&&(document.getElementById("tutFieldInstr").innerHTML='<i class="bi bi-check-circle-fill" style="margin-right:6px;color:#22c55e;"></i><strong>All done! Click Save to complete.</strong>',document.getElementById("tutFieldNum").innerHTML="âœ“",r.arrow.style.display="block",v(e,"up"),e.classList.add("tutorial-submit-highlight"),e.style.cssText="position:relative;z-index:10001;animation:tut-pulse 1.5s infinite;",e.scrollIntoView({behavior:"smooth",block:"center"}))}function $(){const t=document.createElement("div");t.style.cssText="position:fixed;top:20px;right:20px;background:#22c55e;color:white;padding:16px 24px;border-radius:12px;z-index:10005;display:flex;align-items:center;gap:10px;font-weight:600;animation:slideIn 0.4s;",t.innerHTML='<i class="bi bi-check-circle-fill" style="font-size:20px;"></i><span>Great! Moving to next step...</span>',document.body.appendChild(t),setTimeout(()=>t.remove(),1500)}function C(){r.tooltip.style.display="none",r.spotlight.style.display="none",r.arrow.style.display="none";const t=document.createElement("div");t.className="tutorial-complete",t.style.cssText="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:40px;border-radius:16px;text-align:center;z-index:10003;box-shadow:0 25px 50px rgba(0,0,0,0.25);max-width:400px;",t.innerHTML=`
        <div style="font-size:60px;margin-bottom:15px;">ðŸŽ‰</div>
        <h2 style="margin:0 0 15px;color:#1e293b;">Tutorial Complete!</h2>
        <p style="color:#64748b;margin-bottom:25px;">You've learned to create walkins, categories, policies, series, and issue insurance!</p>
        <button onclick="VIMSYSTutorial.finish()" style="background:#2563eb;color:white;border:none;padding:12px 30px;border-radius:8px;font-size:16px;cursor:pointer;">
            <i class="bi bi-check-lg"></i> Got it!
        </button>
    `,document.body.appendChild(t),localStorage.setItem(a.completedKey,"true"),localStorage.removeItem(a.storageKey)}function L(){x(),n++,y(),f(n)}function q(){n<=0||(x(),n--,y(),f(n))}function x(){u.forEach(({el:t,handler:e,type:o})=>{t&&e&&o&&t.removeEventListener(o,e)}),u=[],document.querySelectorAll(".tutorial-highlight, .tutorial-field-active").forEach(t=>{t.classList.remove("tutorial-highlight"),t.classList.remove("tutorial-field-active"),t.style.zIndex="",t.style.position="",t.style.cssText=""}),document.querySelectorAll("input, select, textarea").forEach(t=>{t.style.zIndex="",t.style.position=""}),document.querySelectorAll(".tut-next-btn").forEach(t=>t.remove()),r.tooltip&&(r.tooltip.style.display="none"),r.spotlight&&(r.spotlight.style.display="none"),r.arrow&&(r.arrow.style.display="none")}function y(){localStorage.setItem(a.storageKey,n)}function B(){confirm("Skip tutorial? You can restart from the dashboard anytime.")&&(x(),document.querySelectorAll(".tutorial-overlay, .tutorial-spotlight, .tutorial-tooltip, .tutorial-arrow, .tutorial-css-arrow, .tutorial-welcome, .tutorial-complete").forEach(t=>t.remove()),m=!1,sessionStorage.removeItem("vimsy_tutorial_active"),y())}function V(){document.querySelectorAll(".tutorial-overlay, .tutorial-spotlight, .tutorial-tooltip, .tutorial-arrow, .tutorial-css-arrow, .tutorial-complete").forEach(t=>t.remove()),m=!1,sessionStorage.removeItem("vimsy_tutorial_active")}function W(t){var o,i;if(!m){console.log("Tutorial not active, ignoring action complete event");return}const e=n+1;((o=t.detail)==null?void 0:o.step)===e?(console.log(`Step ${t.detail.step} completed, advancing to next step`),$(),n>=a.steps.length-1?(console.log("Final step completed, showing completion"),setTimeout(()=>{x(),C()},1500)):setTimeout(()=>L(),1500)):console.log(`Step mismatch: expected ${e}, got ${(i=t.detail)==null?void 0:i.step}, currentStep: ${n}`)}const K={start:E,next:L,prev:q,skip:B,finish:V,isActive:()=>m,getStep:()=>n};window.VIMSYSTutorial=K;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k();
